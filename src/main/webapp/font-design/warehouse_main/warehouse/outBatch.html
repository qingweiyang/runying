<!-- 主页面 -->

<!-- 面包屑导航 -->
<ul class="breadcrumb">
  <li>
   <a href="#">仓库管理</a>
  </li>
  <li class="active">
     批量出库
  </li>
</ul>


<div class="panel panel-success table-panel">
  <!-- Default panel contents -->
  <div class="panel-heading">
    <!-- 表格的筛选操作 -->
    <div class="row clearfix">
      
      <div class="col-md-3 column col-md-offset-7">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="输入关键字进行搜索...">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button">
            	<i class='fa fa-search fa-lg'> </i>
            </button>
          </span>
        </div><!-- /input-group -->
      </div><!-- /.col-lg-6 -->
      
      <div class="col-md-1 column">
         <button type="button" class="btn btn-default" onclick="loadOutBatchView();">
         	<i class='fa fa-check-square-o fa-lg'> 出库</i>
         	<span class="badge">0</span>
         </button>
      </div>
      
    </div>
  </div>

  <table id="all-orders-table" class="table table-hover table-bordered">
    <thead>
      <tr class="active">
        <th>订单号</th>
        <th>下达日期</th>
        <th>单据编号</th>
        <th>物料名称</th>
        <th>规格型号</th>
        <th>规格型号2</th>
        <th>数量</th>
        <th>交货日期</th>
        <th>库存量</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- 分页 -->
<nav>
  <ul class="pagination">
  </ul>
</nav>

<script src="../plugins/js/page_division.js"></script>  
<script type="text/javascript">
  var tableVO = {};
  var orders = [];
  
  $(document).ready(function() {
	tableVO = {};
    showAllOrders(1, countPerPage);
  });

  function inWarehouseBatch() {
	  tableVO.rows = orders;
	  $.ajax({
	      type : "POST",
	      contentType : 'application/json', 
	      url : "inWarehouseBatch.do",
	      data : JSON.stringify(tableVO), 
	      dataType: "json",
	      success : function() {
	      },
	      error : function(){
	          alert("error");
	      }
	   });
  }
  
  function addOrders(selector, item) {
	  if(!exist(item)) {
		  orders.push(item);
		  $(selector).find("i").remove();
		  $(selector).append("<i class='fa fa-undo fa-lg'> </i>");
		  $(".badge").text(orders.length);
	  } else {
		  removeArray(item);
		  $(selector).find("i").remove();
		  $(selector).append("<i class='fa fa-cart-plus fa-lg'> </i>");
		  $(".badge").text(orders.length);
	  }
  }
 
  function removeArray(item) {
	  var isExist = false;
	  for(var i = 0 ; i < orders.length ; i++) {
		  if(orders[i].id == item.id) {
			  if(i != orders.length) {
				  orders[i] = orders[orders.length - 1];  
			  }
			  isExist = true;
		  }
	  }
	  if(isExist) {
		  orders.length = orders.length-1;
	  }
  }
  
  function exist(item) {
	  for(var i = 0 ; i < orders.length ; i++) {
		  if(orders[i].id == item.id) {
			  return true;
		  }
	  }
	  return false;
  }
  
  function showAllOrders(currentPage, countPerPage) {
    var param = {};
    param.currentPage = currentPage;
    param.countPerPage = countPerPage;
    $.get(
      "getCheckedOrders.do",
      param,
      function(data) {
        var text = "";
        $.each(data.rows, function(i, item) {
        	if(!exist(item.id)) {
        		option = "<a href='javascript:void(0);' onclick='addOrders(this, "+JSON.stringify(item)+");'><i class='fa fa-cart-plus fa-lg'> </i></a>  ";
        	} else {
        		option = "<a href='javascript:void(0);' onclick='addOrders(this, "+JSON.stringify(item)+");'><i class='fa fa-undo fa-lg'> </i></a>  ";
        	}
        	var releaseTime = getFormatDateByLong(item.releaseTime, "yyyy-MM-dd");
        	var deliveryTime = getFormatDateByLong(item.deliveryTime, "yyyy-MM-dd");
            text += "<tr><td>"+item.id+"</td>"+
                      "<td>"+releaseTime+"</td>"+
                      "<td>"+item.number+"</td>"+
                      "<td>"+item.materialName+"</td>"+
                      "<td>"+item.size1+"</td>"+
                      "<td>"+item.size2+"</td>"+
                      "<td>"+item.count+"</td>"+
                      "<td>"+deliveryTime+"</td>"+
                      "<td>"+item.warehouseCount+"</td>"+
                      "<td>"+option+"</td>"+
                      "</tr>";
        });
        $("#all-orders-table tbody").html(text);
        pageDivision(data.pages, currentPage);
      });
  }

</script>