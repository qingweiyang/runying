
<!-- 主页面 -->

<div id="process-main">
  <!-- 面包屑导航 -->
  <ul class="breadcrumb">
    <li>
     <a href="#">用户管理</a>
    </li>
    <li class="active">
       用户列表
    </li>
  </ul>

  <div class="panel panel-info table-panel">
      <!-- Default panel contents -->
      <div class="panel-heading">
        <!-- 表格的筛选操作 -->
        <div class="row clearfix">

          <!-- 表格select筛选 -->
          <div>
            <div class="col-md-1 column form-pre-des">
              名称
            </div>
            <div class="col-md-2 column">
              <select class="form-control">
                <option>Enter</option>
                <option>Your</option>
                <option>Options</option>
                <option>Here!</option>
              </select>
            </div>
          </div>
          <!-- 表格搜索 -->
          <div class="col-md-3 col-md-offset-5">
            <div class="input-group">
              <input id="search-input" type="text" class="form-control" placeholder="输入关键字进行搜索...">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button" onclick="search();">
					<i class='fa fa-search fa-lg'> </i>
				</button>
              </span>
            </div><!-- /input-group -->
          </div><!-- /.col-lg-6 -->
        </div>
      </div>

      <table id="current-table" class="table table-hover">
        <thead>
          <tr class="active">
            <th>#</th>
            <th>用户名</th>
            <th>权限</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
  </div>

  <!-- 分页 -->
  <nav>
    <ul class="pagination">
    </ul>
  </nav>
</div>

<script src="js/page_division.js"></script>  
<script type="text/javascript">

  $(document).ready(function() {
	  show(1, countPerPage);
  });

  // 权限编辑
  function edit(id) {
    $("#process-main").empty();
    $("#process-main").load("edit.html", function() {
    	loading();
    	$.get(
    		"getSingleUser.do",
    		"id="+id,
    		function(item) {
    	        $("#name-suf-des").text(item.username);
    	        var privilege = item.privilege;
    	        if((privilege & 1) == 1) {
    	          $("#inlineCheckbox1").attr("checked", true);
    	        } 
    	        if(((privilege >> 1) & 1) == 1) {
    	          $("#inlineCheckbox2").attr("checked", true);
    	        } 
    	        if(((privilege >> 2) & 1) == 1) {
    	          $("#inlineCheckbox3").attr("checked", true);
    	        }
    	        if(((privilege >> 3) & 1) == 1) {
    	          $("#inlineCheckbox4").attr("checked", true);
    	        }
    	        loadingEnd();
    	});
    	
    }); 
  }

  function deleteUser(id) {
	  $.get(
		"deleteUser.do",
	  	"id="+id,
	  	function(data) {
	  	if(data.status == 1) {
	  		//刷新
	  	    setTimeout('loadList();', 500);
	  	} else {
            alert(data.description);
	  	}
	 });	 

  }
    
  function show(currentPage, countPerPage) {
	var search = $("#search-input").val();
    var param = {};
    param.currentPage = currentPage;
    param.countPerPage = countPerPage;
    param.search = search;
    
    loading();
    $.post(
      "getAllUser.do",
      param,
      function(data) {
        var text = "";
        var option = "";
        $.each(data.rows, function(i, item) {
        	option = "<a href='javascript:void(0);' onclick='edit("+item.id+");'><i class='fa fa-pencil-square-o fa-lg'> </i></a>  ";
          option += "<a href='javascript:void(0);' onclick='deleteUser("+item.id+");'><i class='fa fa-trash fa-lg'> </i></a>";
          var pri = '';
          var privilege = item.privilege;
          if((privilege & 1) == 1) {
            pri += '<span class="label label-primary">录入订单</span> ';
          } 
          if(((privilege >> 1) & 1) == 1) {
            pri += '<span class="label label-primary">增加工序</span> ';
          } 
          if(((privilege >> 2) & 1) == 1) {
            pri += '<span class="label label-primary">入库出库</span> ';
          }
          if(((privilege >> 3) & 1) == 1) {
            pri += '<span class="label label-success">管理员</span> ';
          }

          text += "<tr><td>"+(i+1+(currentPage-1)*countPerPage)+"</td>"+
                      "<td>"+item.username+"</td>"+
                      "<td>"+pri+"</td>"+
                      "<td>"+option+"</td>"+
                      "</tr>";
        });
        $("#current-table tbody").html(text);
        pageDivision(data.pages, currentPage);
        loadingEnd();
      });
  }
</script>