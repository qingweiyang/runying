<!-- 主页面 -->

<!-- 面包屑导航 -->
<ul class="breadcrumb">
  <li>
   <a href="#">订单查看</a>
  </li>
  <li class="active">
     订单详情
  </li>
</ul>


<div class="panel panel-success table-panel">
  <!-- Default panel contents -->
  <div class="panel-heading">
    <!-- 表格的筛选操作 -->
    <div class="row clearfix">
      
      <!-- 表格select筛选 -->
      <div>
        <div class="col-md-1 column form-pre-des">
          名称
        </div>
        <div class="col-md-2 column">
          <select class="form-control">
            <option>Enter</option>
            <option>Your</option>
            <option>Options</option>
            <option>Here!</option>
          </select>
        </div>
      </div>

      <div class="col-md-3 col-md-offset-5">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="输入关键字进行搜索...">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button">搜索</button>
          </span>
        </div><!-- /input-group -->
      </div><!-- /.col-lg-6 -->
    </div>
  </div>

  <table id="all-orders-table" class="table table-hover table-bordered">
    <thead>
      <tr class="active">
        <th>订单号</th>
        <th>下达日期</th>
        <th>单据编号</th>
        <th>物料名称</th>
        <th>规格型号</th>
        <th>规格型号2</th>
        <th>数量</th>
        <th>交货日期</th>
        <th>备注</th>
        <th>物料长代码</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- 分页 -->
<nav>
  <ul class="pagination">
    <li>
       <a href="#">Prev</a>
    </li>
    <li class="active">
       <a href="#">1</a>
    </li>
    <li>
       <a href="#">2</a>
    </li>
    <li>
       <a href="#">3</a>
    </li>
    <li>
       <a href="#">...</a>
    </li>
    <li>
       <a href="#">4</a>
    </li>
    <li>
       <a href="#">5</a>
    </li>
    <li>
       <a href="#">Next</a>
    </li>
  </ul>
</nav>
  
<script type="text/javascript">
  var countPerPage = 10;
  $(document).ready(function() {
    showAllOrders(1, countPerPage);

  });

  // 点击分页，执行翻页操作
  function pageClick(select, currentPage, pages) {
    var cp = $(select).text();
    if(cp == "上一页" && currentPage > 1) {
      currentPage = currentPage - 1;
    } else if(cp == "下一页" && currentPage < pages) {
      currentPage = currentPage + 1;
    } else if(cp != "上一页" && cp != "下一页") {
    	currentPage = cp;
    } 
    showAllOrders(Number(currentPage), countPerPage);
  }
  
  // 分页的显示
  function pageDivision(pages, currentPage) {
    $(".pagination").children().remove();
    // 共展示的分页条数（如10页）
    var pnum = 7;
    var mid = parseInt(pnum/2);
    var begin = 1;
    var last = begin + pages;
    if(pages > pnum) {
      if(currentPage - mid > 0 && currentPage + mid - 1 < pages) {
        begin = currentPage -mid;
        last = begin + pnum;
      } else if ( (currentPage - 1 + mid ) >= pages) {
        begin = pages - pnum + 1;
        last = begin + pnum;
      } else if (currentPage - mid < 1) {
        last = begin + pnum;
      }
    }
    
    // 上一页
    $(".pagination").append('<li><a href="#" onclick="pageClick(this, '+currentPage+', '+pages+');">上一页</a></li>');
    for(var i = begin ; i < last ; i ++) {
      if(i == currentPage) {
        // 设置当前页class
        $(".pagination").append('<li class="active"><a href="#" onclick="pageClick(this, '+i+', '+pages+');">'+i+'</a></li>');
      } else {
        $(".pagination").append('<li><a href="#" onclick="pageClick(this, '+i+', '+pages+');">'+i+'</a></li>');
      }
    }
    // 下一页
    $(".pagination").append('<li><a href="#" onclick="pageClick(this, '+currentPage+', '+pages+');">下一页</a></li>');
    
  }

  function showAllOrders(currentPage, countPerPage) {
    var param = {};
    param.currentPage = currentPage;
    param.countPerPage = countPerPage;
    $.get(
      "getAllOrders.do",
      param,
      function(data) {
        var text = "";
        $.each(data.rows, function(i, item) {
        	var releaseTime = getFormatDateByLong(item.releaseTime, "yyyy-MM-dd");
        	var deliveryTime = getFormatDateByLong(item.deliveryTime, "yyyy-MM-dd");
            text += "<tr><td>"+item.id+"</td>"+
                      "<td>"+releaseTime+"</td>"+
                      "<td>"+item.number+"</td>"+
                      "<td>"+item.product.materialName+"</td>"+
                      "<td>"+item.product.size1+"</td>"+
                      "<td>"+item.product.size2+"</td>"+
                      "<td>"+item.count+"</td>"+
                      "<td>"+deliveryTime+"</td>"+
                      "<td>"+item.remarks+"</td>"+
                      "<td>"+item.product.materialCode+"</td>"+
                      "</tr>";
        });
        $("#all-orders-table tbody").html(text);
        pageDivision(data.pages, currentPage);
      });
  }

</script>